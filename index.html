<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>なんでもメロスコンバータ - 道具箱｜ここはmidomoの自由なことをするホームページなので、タイトルをどれだけ長くできるか挑戦してみます。楽市楽座。そう考えれば、最近のなろう系作品もこのようにしてタイトルが長くなっているのかもしれませんね。</title>

    <link href="https://midomo.neocities.org/style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400&display=swap" rel="stylesheet">

    <!-- sudachi.js -->
    <script src="https://unpkg.com/sudachi-js/dist/sudachi.js"></script>

    <style>
      #inputWrapper {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      #clearBtn {
        cursor: pointer;
        background: #eee;
        border: 1px solid #ccc;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
        user-select: none;
      }
      #clearBtn:hover {
        background: #ddd;
      }
      #resultWrapper {
        margin-top: 12px;
        padding: 10px;
        border: 1px solid #ddd;
        background: #fafafa;
        border-radius: 6px;
      }
      #copyBtn {
        float: right;
        cursor: pointer;
        background: #eee;
        border: 1px solid #ccc;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
        user-select: none;
        color: black;
      }
      #copyBtn:hover {
        background: #ddd;
      }
      #result {
        white-space: pre-wrap;
        font-family: monospace;
        margin-top: 6px;
        color: black;
      }
    </style>
  </head>

  <body class="zen-kaku-gothic-new-light">
    <div class="contents">
      <h1>なんでもメロスコンバータ - Dougubako</h1>
      <p>てきとう。品詞とかごっちゃごちゃ。エンタメとして使ってね</p>

      <div id="inputWrapper">
        <input id="urlInput" type="text" placeholder="走るな！メロス" style="flex:1;">
        <div id="clearBtn" onclick="clearInput()">✕</div>
      </div>

      <button onclick="runMeros()">メロス化する</button>

      <div id="resultWrapper" style="display:none;">
        <div id="copyBtn" onclick="copyResult()">コピー</div>
        <div id="result"></div>
      </div>

      <p>
        <a href="https://midomo.neocities.org/">Home</a>▸
        <a href="https://midomo.neocities.org/dougubako/dougubako">道具箱</a>▸
        なんでもメロスコンバータ
      </p>
    </div>

    <script>
      let tokenizer;
      let posLists = {};

      // ===== 品詞マップ（そのまま）=====
      const posMap = {
        "補助記号-読点": "dokuten",
        "補助記号-句点": "kuten",
        "助詞-係助詞": "keijyoshi",
        "助詞-接続助詞": "setsuzokujyoshi",
        "助詞-格助詞": "kakujyoshi",
        "助詞-準体助詞": "jyuntaijyoshi",
        "動詞-非自立可能": "doushi_hijiritsu",
        "名詞-普通名詞-一般": "hutsuumeishi_ippan",
        "補助記号-括弧開": "kakkokai",
        "補助記号-括弧閉": "kakkotoji",
        "空白": "kuuhaku",
        "代名詞": "daimeishi",
        "助動詞": "jyodoushi",
        "連体詞": "rentaishi",
        "形容詞-非自立可能": "keiyoushi_hijiritsu",
        "助詞-終助詞": "syuujyoshi",
        "名詞-固有名詞-人名-一般": "jinmei_ippan",
        "感動詞-一般": "kanndoushi_ippan",
        "助詞-副助詞": "hukujyoshi",
        "形状詞-助動詞語幹": "keijyoushi_jyodoushigokan",
        "名詞-数詞": "suushi",
        "接頭辞": "settouji",
        "動詞-一般": "doushi_ippan",
        "副詞": "hukushi",
        "接尾辞-名詞的-一般": "setsubiji_meishiteki_ippan",
        "名詞-普通名詞-副詞可能": "meishi_hutsuumeishi_hukushikanou",
        "名詞-普通名詞-サ変可能": "meishi_hutsuumeishi_sahenkanou",
        "名詞-普通名詞-助数詞可能": "meishi_hutsuumeishi_jyosuushikanou",
        "接続詞": "setsuzokushi",
        "接尾辞-名詞的-助数詞": "setsubiji_meishiteki_jyosuushi",
        "補助記号-一般": "hojyokigou_ippan",
        "形容詞-一般": "keijyoushi_ippan",
        "名詞-固有名詞-地名-一般": "meishi_koyuumeishi_chimei_ippan",
        "形状詞-一般": "keijyoushi_ippan",
        "名詞-固有名詞-人名-姓": "meishi_koyuumeishi_jinmei_sei",
        "名詞-普通名詞-形状詞可能": "meishi_hutsuumeishi_keijyoushikanou",
        "記号-一般": "kigou_ippan",
        "感動詞-フィラー": "kandoushi_fira-",
        "接尾辞-名詞的-サ変可能": "setsubiji_meishiteki_sahenkanou",
        "形状詞-タリ": "keijyoushi_tari",
        "名詞-固有名詞-一般": "meishi_koyuumeishi_ippan",
        "名詞-固有名詞-人名-名": "meishi_koyuumeishi_jinmei_mei"
      };

      // ===== 初期化 =====
      async function init() {
        const dic = await Sudachi.Dictionary.load();
        tokenizer = dic.create();
        await loadCSV();
      }

      // ===== CSV 読み込み =====
      async function loadCSV() {
        const res = await fetch("./merosukaiseki.csv");
        const text = await res.text();
        const lines = text.split("\n");
        lines.shift(); // header

        for (const line of lines) {
          if (!line.trim()) continue;
          const [pos, word] = line.split(",");
          if (!posLists[pos]) posLists[pos] = [];
          posLists[pos].push(word);
        }
      }

      // ===== 形態素解析 =====
      function getPosList(sentence) {
        const tokens = tokenizer.tokenize(sentence, Sudachi.Tokenizer.SplitMode.C);
        const result = [];

        for (const token of tokens) {
          const pos = token.partOfSpeech();
          if (pos[0] === "補助記号") {
            result.push(token.surface());
          } else {
            result.push(pos.slice(0, 6).join("-"));
          }
        }
        return result;
      }

      // ===== 生成 =====
      function generateSentence(template) {
        let out = "";
        for (const t of template) {
          if (posLists[t]) {
            const words = posLists[t];
            out += words[Math.floor(Math.random() * words.length)];
          } else {
            out += t;
          }
        }
        return out;
      }

      function runMeros() {
        const input = document.getElementById("urlInput").value || "走るな！メロス";
        const posList = getPosList(input);
        const sentence = generateSentence(posList);

        document.getElementById("result").textContent = sentence;
        document.getElementById("resultWrapper").style.display = "block";
      }

      function clearInput() {
        document.getElementById("urlInput").value = "";
        document.getElementById("result").textContent = "";
        document.getElementById("resultWrapper").style.display = "none";
      }

      function copyResult() {
        const text = document.getElementById("result").textContent;
        navigator.clipboard.writeText(text);
      }

      init();
    </script>
  </body>
</html>
